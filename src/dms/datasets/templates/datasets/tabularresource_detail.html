{% extends 'datasets/resource_detail_base.html' %}
{% load static %}
{% load render_table from django_tables2 %}


{% block resource_specific_content %}
{% if data_table %}
<c-accordion.item value='data'>
    <c-accordion.trigger value='data' class="text-2xl font-bold">Data Tables and Layers</c-accordion.trigger>
    <c-accordion.content value='data'>
        {% render_table data_table %}
    </c-accordion.content>
</c-accordion.item>
{% endif %}
{% if object.metadata.driverShortName == 'Parquet' %}
<c-accordion.item value='preview'>
    <c-accordion.trigger value='preview' class="text-2xl font-bold">Preview</c-accordion.trigger>
    <c-accordion.content value='preview'>
        <iframe id="parquet-preview" style="width:100%; height:800px; border:none;">
        </iframe>
    </c-accordion.content>
</c-accordion.item>
<script>
    const query = btoa(document.getElementById('datasets/snippets/duckdb-sql-code').textContent.trim());
    const title = "{{ object.title }} - {{ object.id }}";
    const params = new URLSearchParams({
        query: query,
        execute: 'true',
        title: title
    });
    document.getElementById('parquet-preview').src = "{{ DUCKUI_URL }}?" + params.toString();
</script>
{% endif %}
{% endblock resource_specific_content %}
